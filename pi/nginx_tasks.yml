- name: Install nginx package
  apt:
    name: nginx


# Look at replacing this with adding a file to
# /etc/nginx/conf.d
- name: Increase server_names_hash_bucket_size in nginx.conf
  lineinfile:
    path: /etc/nginx/nginx.conf
    insertafter: "^http {"
    line: "server_names_hash_bucket_size 64;"
  notify:
    - Restart nginx


- name: Setup www.goodenoughmoney.com home
  file:
    path: /opt/goodenoughmoney
    state: directory
    owner: root
    group: admin
    mode: '0775'


- name: Install www.goodenoughmoney.com config
  copy:
    src: root/etc/nginx/sites-available/goodenoughmoney.com
    dest: /etc/nginx/sites-available/goodenoughmoney.com
    owner: root
    group: admin
    mode: '0664'
  notify:
    - Restart nginx


- name: Enable www.goodenoughmoney.com
  file:
    src: /etc/nginx/sites-available/goodenoughmoney.com
    dest: /etc/nginx/sites-enabled/goodenoughmoney.com
    state: link


- name: Install home.scottmuc.com config
  copy:
    src: root/etc/nginx/sites-available/home.scottmuc.com
    dest: /etc/nginx/sites-available/home.scottmuc.com
    owner: root
    group: admin
    mode: '0664'
  notify:
    - Restart nginx


- name: Enable home.scottmuc.com
  file:
    src: /etc/nginx/sites-available/home.scottmuc.com
    dest: /etc/nginx/sites-enabled/home.scottmuc.com
    state: link


- name: Enable stub_status
  copy:
    src: root/etc/nginx/conf.d/status.conf
    dest: /etc/nginx/conf.d/status.conf
    owner: root
    group: admin
    mode: '0664'
  tags:
    - wip
  notify:
    - Restart nginx


# Are there trade-offs when ensuring a started and enabled state
# in the same task?
- name: Start nginx
  service:
    name: nginx
    state: started
    enabled: true
