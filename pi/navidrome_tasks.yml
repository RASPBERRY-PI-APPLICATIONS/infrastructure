
  - name: Navidrome user
    user:
      name: navidrome
      comment: Service account for navidrome process
      system: Yes


  - name: Navidrome application directory
    file:
      path: /opt/navidrome
      state: directory
      owner: navidrome
      group: root


  - name: ffmpeg directory
    file:
      path: /opt/navidrome/ffmpeg
      state: directory
      owner: navidrome
      group: root


  - name: Install ffmpeg
    unarchive:
      src: https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-armhf-static.tar.xz
      remote_src: True
      dest: /opt/navidrome/ffmpeg
      creates: /opt/navidrome/ffmpeg/ffmpeg
      extra_opts:
      - --strip-components=1


  - name: Install navidrome service
    copy:
      src: root/etc/systemd/system/navidrome.service
      dest: /etc/systemd/system/navidrome.service


  - name: Install navidrome configuration
    copy:
      src: root/opt/navidrome/navidrome.toml
      dest: /opt/navidrome/navidrome.toml
